{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      },
      {
        "datasource": {
          "type": "postgres",
          "uid": "timescaledb"
        },
        "enable": true,
        "iconColor": "red",
        "name": "Charging Events",
        "rawQuery": "SELECT time as time, 'Charging Started' as text FROM ev_telemetry WHERE is_charging = true AND time > NOW() - INTERVAL '1 hour'"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "liveNow": true,
  "panels": [
      {
        "id": 1,
        "title": "State of Charge (SoC)",
        "type": "timeseries",
        "gridPos": {"x": 0, "y": 0, "w": 12, "h": 8},
        "targets": [{
          "datasource": "TimescaleDB",
          "rawSql": "SELECT time, soc FROM ev_telemetry WHERE time > NOW() - INTERVAL '15 minutes' ORDER BY time",
          "format": "time_series"
        }],
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "custom": {
              "lineWidth": 2,
              "fillOpacity": 20,
              "showPoints": "never"
            },
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 20, "color": "yellow"},
                {"value": 50, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 2,
        "title": "State of Health (SoH)",
        "type": "timeseries",
        "gridPos": {"x": 12, "y": 0, "w": 12, "h": 8},
        "targets": [{
          "datasource": "TimescaleDB",
          "rawSql": "SELECT time, soh FROM ev_telemetry WHERE time > NOW() - INTERVAL '15 minutes' ORDER BY time",
          "format": "time_series"
        }],
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "custom": {
              "lineWidth": 2,
              "fillOpacity": 15
            },
            "unit": "percent",
            "min": 70,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 70, "color": "red"},
                {"value": 85, "color": "yellow"},
                {"value": 95, "color": "green"}
              ]
            }
          }
        }
      },
      {
        "id": 3,
        "title": "Battery Temperature",
        "type": "timeseries",
        "gridPos": {"x": 0, "y": 8, "w": 12, "h": 8},
        "targets": [{
          "datasource": "TimescaleDB",
          "rawSql": "SELECT time, temperature FROM ev_telemetry WHERE time > NOW() - INTERVAL '15 minutes' ORDER BY time",
          "format": "time_series"
        }],
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "custom": {
              "lineWidth": 3,
              "gradientMode": "scheme"
            },
            "unit": "celsius",
            "min": 20,
            "max": 80,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 20, "color": "blue"},
                {"value": 40, "color": "green"},
                {"value": 60, "color": "yellow"},
                {"value": 70, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "id": 4,
        "title": "Remaining Useful Life (RUL)",
        "type": "gauge",
        "gridPos": {"x": 12, "y": 8, "w": 6, "h": 8},
        "targets": [{
          "datasource": "TimescaleDB",
          "rawSql": "SELECT rul_prediction FROM ev_telemetry ORDER BY time DESC LIMIT 1",
          "format": "table"
        }],
        "options": {
          "showThresholdLabels": true,
          "showThresholdMarkers": true
        },
        "fieldConfig": {
          "defaults": {
            "unit": "none",
            "min": 0,
            "max": 1000,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "red"},
                {"value": 100, "color": "yellow"},
                {"value": 500, "color": "green"}
              ]
            }
          },
          "overrides": [{
            "matcher": {"id": "byName", "options": "rul_prediction"},
            "properties": [{
              "id": "displayName",
              "value": "Cycles Remaining"
            }]
          }]
        }
      },
      {
        "id": 5,
        "title": "Failure Probability",
        "type": "gauge",
        "gridPos": {"x": 18, "y": 8, "w": 6, "h": 8},
        "targets": [{
          "datasource": "TimescaleDB",
          "rawSql": "SELECT failure_probability * 100 as failure_pct FROM ev_telemetry ORDER BY time DESC LIMIT 1",
          "format": "table"
        }],
        "options": {
          "showThresholdLabels": true,
          "showThresholdMarkers": true
        },
        "fieldConfig": {
          "defaults": {
            "unit": "percent",
            "min": 0,
            "max": 100,
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": 0, "color": "green"},
                {"value": 30, "color": "yellow"},
                {"value": 60, "color": "orange"},
                {"value": 80, "color": "red"}
              ]
            }
          }
        }
      },
      {
        "id": 6,
        "title": "Voltage & Current",
        "type": "timeseries",
        "gridPos": {"x": 0, "y": 16, "w": 12, "h": 8},
        "targets": [
          {
            "datasource": "TimescaleDB",
            "rawSql": "SELECT time, voltage FROM ev_telemetry WHERE time > NOW() - INTERVAL '15 minutes' ORDER BY time",
            "format": "time_series",
            "alias": "Voltage"
          },
          {
            "datasource": "TimescaleDB",
            "rawSql": "SELECT time, current FROM ev_telemetry WHERE time > NOW() - INTERVAL '15 minutes' ORDER BY time",
            "format": "time_series",
            "alias": "Current"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "custom": {
              "lineWidth": 2,
              "fillOpacity": 10
            }
          },
          "overrides": [
            {
              "matcher": {"id": "byName", "options": "voltage"},
              "properties": [
                {"id": "unit", "value": "volt"},
                {"id": "color", "value": {"mode": "fixed", "fixedColor": "blue"}},
                {"id": "custom.axisPlacement", "value": "left"}
              ]
            },
            {
              "matcher": {"id": "byName", "options": "current"},
              "properties": [
                {"id": "unit", "value": "amp"},
                {"id": "color", "value": {"mode": "fixed", "fixedColor": "orange"}},
                {"id": "custom.axisPlacement", "value": "right"}
              ]
            }
          ]
        }
      },
      {
        "id": 7,
        "title": "Power Consumption",
        "type": "timeseries",
        "gridPos": {"x": 12, "y": 16, "w": 12, "h": 8},
        "targets": [{
          "datasource": "TimescaleDB",
          "rawSql": "SELECT time, power_consumption FROM ev_telemetry WHERE time > NOW() - INTERVAL '15 minutes' ORDER BY time",
          "format": "time_series"
        }],
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "custom": {
              "lineWidth": 2,
              "fillOpacity": 30,
              "gradientMode": "opacity"
            },
            "unit": "watt"
          }
        }
      },
      {
        "id": 8,
        "title": "Current Battery Statistics",
        "type": "stat",
        "gridPos": {"x": 0, "y": 24, "w": 24, "h": 4},
        "targets": [{
          "datasource": "TimescaleDB",
          "rawSql": "SELECT soc as \"SoC (%)\", soh as \"SoH (%)\", temperature as \"Temp (Â°C)\", charge_cycles as \"Cycles\", voltage as \"Voltage (V)\", current as \"Current (A)\" FROM ev_telemetry ORDER BY time DESC LIMIT 1",
          "format": "table"
        }],
        "options": {
          "graphMode": "area",
          "colorMode": "value",
          "justifyMode": "auto",
          "textMode": "auto"
        },
        "fieldConfig": {
          "defaults": {
            "mappings": [],
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"value": null, "color": "green"}
              ]
            }
          }
        }
      }
    ],
    "templating": {
      "list": [
        {
          "name": "battery_id",
          "type": "query",
          "datasource": "TimescaleDB",
          "query": "SELECT DISTINCT battery_id FROM ev_telemetry",
          "current": {
            "value": "BATTERY_001",
            "text": "BATTERY_001"
          }
        }
      ]
    }
  }
